!function(e,t,n,i){e.fn.dropdown=function(t){var o,a=e(this),s=e(n),r=a.selector||"",u="ontouchstart"in n.documentElement,c=(new Date).getTime(),d=[],l=arguments[0],f="string"==typeof l,m=[].slice.call(arguments,1);return a.each(function(){var n,v=e.isPlainObject(t)?e.extend(!0,{},e.fn.dropdown.settings,t):e.extend({},e.fn.dropdown.settings),h=v.className,g=v.metadata,p=v.namespace,b=v.selector,y=v.error,w="."+p,x="module-"+p,T=e(this),k=T.find(b.item),C=T.find(b.text),D=T.find(b.input),E=T.children(b.menu),O=this,A=T.data(x);n={initialize:function(){n.debug("Initializing dropdown",v),n.save.defaults(),n.set.selected(),u&&n.bind.touchEvents(),n.bind.mouseEvents(),n.bind.keyboardEvents(),n.instantiate()},instantiate:function(){n.verbose("Storing instance of dropdown",n),A=n,T.data(x,n)},destroy:function(){n.verbose("Destroying previous dropdown for",T),k.off(w),T.off(w).removeData(x)},bind:{keyboardEvents:function(){n.debug("Binding keyboard events"),T.on("keydown"+w,n.handleKeyboard),T.on("focus"+w,n.show)},touchEvents:function(){n.debug("Touch device detected binding touch events"),T.on("touchstart"+w,n.event.test.toggle),k.on("touchstart"+w,n.event.item.mouseenter).on("touchstart"+w,n.event.item.click)},mouseEvents:function(){n.verbose("Mouse detected binding mouse events"),"click"==v.on?T.on("click"+w,n.event.test.toggle):"hover"==v.on?T.on("mouseenter"+w,n.delay.show).on("mouseleave"+w,n.delay.hide):T.on(v.on+w,n.toggle),k.on("mouseenter"+w,n.event.item.mouseenter).on("mouseleave"+w,n.event.item.mouseleave).on("click"+w,n.event.item.click)},intent:function(){n.verbose("Binding hide intent event to document"),u&&s.on("touchstart"+w,n.event.test.touch).on("touchmove"+w,n.event.test.touch),s.on("click"+w,n.event.test.hide)}},unbind:{intent:function(){n.verbose("Removing hide intent event from document"),u&&s.off("touchstart"+w).off("touchmove"+w),s.off("click"+w)}},handleKeyboard:function(t){var i,o=k.filter("."+h.selected),a=t.which,s={enter:13,escape:27,upArrow:38,downArrow:40},r=h.selected,u=k.index(o),c=o.size()>0,d=k.size();if(a==s.escape&&(n.verbose("Escape key pressed, closing dropdown"),n.hide()),n.is.visible()){if(a==s.enter&&c)return n.verbose("Enter key pressed, choosing selected item"),e.proxy(n.event.item.click,k.filter("."+r))(t),t.preventDefault(),!1;a==s.upArrow?(n.verbose("Up key pressed, changing active item"),i=0>u-1?u:u-1,k.removeClass(r).eq(i).addClass(r),t.preventDefault()):a==s.downArrow&&(n.verbose("Down key pressed, changing active item"),i=u+1>=d?u:u+1,k.removeClass(r).eq(i).addClass(r),t.preventDefault())}else a==s.enter&&n.show()},event:{test:{toggle:function(e){n.determine.intent(e,n.toggle)&&e.preventDefault()},touch:function(e){n.determine.intent(e,function(){"touchstart"==e.type?n.timer=setTimeout(n.hide,v.delay.touch):"touchmove"==e.type&&clearTimeout(n.timer)}),e.stopPropagation()},hide:function(e){n.determine.intent(e,n.hide)}},item:{mouseenter:function(t){var i=e(this).find(b.submenu),o=e(this).siblings(b.item).children(b.menu);(i.length>0||o.length>0)&&(clearTimeout(n.itemTimer),n.itemTimer=setTimeout(function(){o.length>0&&n.animate.hide(!1,o.filter(":visible")),i.length>0&&(n.verbose("Showing sub-menu",i),n.animate.show(!1,i))},2*v.delay.show),t.preventDefault(),t.stopPropagation())},mouseleave:function(){var t=e(this).find(b.menu);t.size()>0&&(clearTimeout(n.itemTimer),n.itemTimer=setTimeout(function(){n.verbose("Hiding sub-menu",t),n.animate.hide(!1,t)},v.delay.hide))},click:function(t){var o=e(this),a=o.data(g.text)!==i?o.data(g.text):o.text(),s=o.data(g.value)!==i?o.data(g.value):"string"==typeof a?a.toLowerCase():a,r=function(){n.determine.selectAction(a,s),e.proxy(v.onChange,O)(s,a)};0===o.find(b.menu).size()&&("touchstart"==t.type?o.one("click",r):r())}},resetStyle:function(){e(this).removeAttr("style")}},determine:{selectAction:function(t,i){n.verbose("Determining action",v.action),e.isFunction(n.action[v.action])?(n.verbose("Triggering preset action",v.action,t,i),n.action[v.action](t,i)):e.isFunction(v.action)?(n.verbose("Triggering user action",v.action,t,i),v.action(t,i)):n.error(y.action,v.action)},intent:function(t,i){return n.debug("Determining whether event occurred in dropdown",t.target),i=i||function(){},0===e(t.target).closest(E).size()?(n.verbose("Triggering event",i),i(),!0):(n.verbose("Event occurred in dropdown, canceling callback"),!1)}},action:{nothing:function(){},hide:function(){n.hide()},activate:function(e,t){t=t!==i?t:e,n.set.selected(t),n.set.value(t),n.hide()},auto:function(e,t){t=t!==i?t:e,n.set.selected(t),n.set.value(t),n.hide()},changeText:function(e,t){t=t!==i?t:e,n.set.selected(t),n.hide()},updateForm:function(e,t){t=t!==i?t:e,n.set.selected(t),n.set.value(t),n.hide()}},get:{text:function(){return C.text()},value:function(){return D.size()>0?D.val():T.data(g.value)},item:function(t,o){var a=!1;return t=t!==i?t:n.get.value()!==i?n.get.value():n.get.text(),o===i&&""===t?(n.debug("Ambiguous dropdown value using strict type check",t),o=!0):o=o||!1,t!==i?k.each(function(){var n=e(this),s=n.data(g.text)!==i?n.data(g.text):n.text(),r=n.data(g.value)!==i?n.data(g.value):"string"==typeof s?s.toLowerCase():s;o?r===t?a=e(this):a||s!==t||(a=e(this)):r==t?a=e(this):a||s!=t||(a=e(this))}):t=n.get.text(),a||!1}},restore:{defaults:function(){n.restore.defaultText(),n.restore.defaultValue()},defaultText:function(){var e=T.data(g.defaultText);n.debug("Restoring default text",e),n.set.text(e)},defaultValue:function(){var e=T.data(g.defaultValue);e!==i&&(n.debug("Restoring default value",e),n.set.selected(e),n.set.value(e))}},save:{defaults:function(){n.save.defaultText(),n.save.defaultValue()},defaultValue:function(){T.data(g.defaultValue,n.get.value())},defaultText:function(){T.data(g.defaultText,C.text())}},set:{text:function(e){n.debug("Changing text",e,C),C.removeClass(h.placeholder),C.text(e)},value:function(e){n.debug("Adding selected value to hidden input",e,D),D.size()>0?D.val(e).trigger("change"):T.data(g.value,e)},active:function(){T.addClass(h.active)},visible:function(){T.addClass(h.visible)},selected:function(e){var t,o=n.get.item(e);o&&(n.debug("Setting selected menu item to",o),t=o.data(g.text)!==i?o.data(g.text):o.text(),k.removeClass(h.active),o.addClass(h.active),n.set.text(t))}},remove:{active:function(){T.removeClass(h.active)},visible:function(){T.removeClass(h.visible)}},is:{selection:function(){return T.hasClass(h.selection)},animated:function(e){return e?e.is(":animated")||e.transition&&e.transition("is animating"):E.is(":animated")||E.transition&&E.transition("is animating")},visible:function(e){return e?e.is(":visible"):E.is(":visible")},hidden:function(e){return e?e.is(":not(:visible)"):E.is(":not(:visible)")}},can:{click:function(){return u||"click"==v.on},show:function(){return!T.hasClass(h.disabled)}},animate:{show:function(t,o){var a=o||E;t=t||function(){},n.is.hidden(a)&&(n.verbose("Doing menu show animation",a),"none"==v.transition?t():e.fn.transition!==i&&T.transition("is supported")?a.transition({animation:v.transition+" in",duration:v.duration,complete:t,queue:!1}):"slide down"==v.transition?a.hide().clearQueue().children().clearQueue().css("opacity",0).delay(50).animate({opacity:1},v.duration,"easeOutQuad",n.event.resetStyle).end().slideDown(100,"easeOutQuad",function(){e.proxy(n.event.resetStyle,this)(),t()}):"fade"==v.transition?a.hide().clearQueue().fadeIn(v.duration,function(){e.proxy(n.event.resetStyle,this)(),t()}):n.error(y.transition,v.transition))},hide:function(t,o){var a=o||E;t=t||function(){},n.is.visible(a)&&(n.verbose("Doing menu hide animation",a),e.fn.transition!==i&&T.transition("is supported")?a.transition({animation:v.transition+" out",duration:v.duration,complete:t,queue:!1}):"none"==v.transition?t():"slide down"==v.transition?a.show().clearQueue().children().clearQueue().css("opacity",1).animate({opacity:0},100,"easeOutQuad",n.event.resetStyle).end().delay(50).slideUp(100,"easeOutQuad",function(){e.proxy(n.event.resetStyle,this)(),t()}):"fade"==v.transition?a.show().clearQueue().fadeOut(150,function(){e.proxy(n.event.resetStyle,this)(),t()}):n.error(y.transition))}},show:function(){n.debug("Checking if dropdown can show"),n.is.hidden()&&(n.hideOthers(),n.set.active(),n.animate.show(function(){n.can.click()&&n.bind.intent(),n.set.visible()}),e.proxy(v.onShow,O)())},hide:function(){!n.is.animated()&&n.is.visible()&&(n.debug("Hiding dropdown"),n.can.click()&&n.unbind.intent(),n.remove.active(),n.animate.hide(n.remove.visible),e.proxy(v.onHide,O)())},delay:{show:function(){n.verbose("Delaying show event to ensure user intent"),clearTimeout(n.timer),n.timer=setTimeout(n.show,v.delay.show)},hide:function(){n.verbose("Delaying hide event to ensure user intent"),clearTimeout(n.timer),n.timer=setTimeout(n.hide,v.delay.hide)}},hideOthers:function(){n.verbose("Finding other dropdowns to hide"),a.not(T).has(b.menu+":visible").dropdown("hide")},toggle:function(){n.verbose("Toggling menu visibility"),n.is.hidden()?n.show():n.hide()},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,v,t);else{if(n===i)return v[t];v[t]=n}},internal:function(t,o){if(e.isPlainObject(t))e.extend(!0,n,t);else{if(o===i)return n[t];n[t]=o}},debug:function(){v.debug&&(v.performance?n.performance.log(arguments):(n.debug=Function.prototype.bind.call(console.info,console,v.name+":"),n.debug.apply(console,arguments)))},verbose:function(){v.verbose&&v.debug&&(v.performance?n.performance.log(arguments):(n.verbose=Function.prototype.bind.call(console.info,console,v.name+":"),n.verbose.apply(console,arguments)))},error:function(){n.error=Function.prototype.bind.call(console.error,console,v.name+":"),n.error.apply(console,arguments)},performance:{log:function(e){var t,i,o;v.performance&&(t=(new Date).getTime(),o=c||t,i=t-o,c=t,d.push({Element:O,Name:e[0],Arguments:[].slice.call(e,1)||"","Execution Time":i})),clearTimeout(n.performance.timer),n.performance.timer=setTimeout(n.performance.display,100)},display:function(){var t=v.name+":",o=0;c=!1,clearTimeout(n.performance.timer),e.each(d,function(e,t){o+=t["Execution Time"]}),t+=" "+o+"ms",r&&(t+=" '"+r+"'"),(console.group!==i||console.table!==i)&&d.length>0&&(console.groupCollapsed(t),console.table?console.table(d):e.each(d,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),d=[]}},invoke:function(t,a,s){var r,u,c,d=A;return a=a||m,s=O||s,"string"==typeof t&&d!==i&&(t=t.split(/[\. ]/),r=t.length-1,e.each(t,function(o,a){var s=o!=r?a+t[o+1].charAt(0).toUpperCase()+t[o+1].slice(1):t;if(e.isPlainObject(d[s])&&o!=r)d=d[s];else{if(d[s]!==i)return u=d[s],!1;if(!e.isPlainObject(d[a])||o==r)return d[a]!==i?(u=d[a],!1):(n.error(y.method,t),!1);d=d[a]}})),e.isFunction(u)?c=u.apply(s,a):u!==i&&(c=u),e.isArray(o)?o.push(c):o!==i?o=[o,c]:c!==i&&(o=c),u}},f?(A===i&&n.initialize(),n.invoke(l)):(A!==i&&n.destroy(),n.initialize())}),o!==i?o:this},e.fn.dropdown.settings={name:"Dropdown",namespace:"dropdown",debug:!1,verbose:!0,performance:!0,on:"click",action:"activate",delay:{show:200,hide:300,touch:50},transition:"slide down",duration:250,onChange:function(){},onShow:function(){},onHide:function(){},error:{action:"You called a dropdown action that was not defined",method:"The method you called is not defined.",transition:"The requested transition was not found"},metadata:{defaultText:"defaultText",defaultValue:"defaultValue",text:"text",value:"value"},selector:{menu:".menu",submenu:"> .menu",item:".menu > .item",text:"> .text",input:'> input[type="hidden"]'},className:{active:"active",placeholder:"default",disabled:"disabled",visible:"visible",selected:"selected",selection:"selection"}},e.extend(e.easing,{easeOutQuad:function(e,t,n,i,o){return-i*(t/=o)*(t-2)+n}})}(jQuery,window,document);