!function(e,t,r,n){e.api=e.fn.api=function(r){var o,a,i=e.extend(!0,{},e.api.settings,r),s="function"!=typeof this?this:e("<div/>"),c=i.stateContext?e(i.stateContext):e(s),u="object"==typeof this?e(s):c,l=this,d=(new Date).getTime(),f=[],p=u.selector||"",g=i.namespace+"-module",m=i.className,h=i.metadata,b=i.error,v=u.data(g),x=arguments[0],y=v!==n&&"string"==typeof x,C=[].slice.call(arguments,1);return o={initialize:function(){var r,a,s,l,d,f,p=(new Date).getTime(),g={},v={};return i.serializeForm&&e(this).toJSON()!==n&&(g=o.get.formData(),o.debug("Adding form data to API Request",g),e.extend(!0,i.data,g)),r=e.proxy(i.beforeSend,u)(i),r===n||r?(l=o.get.url(o.get.templateURL()))?(s=e.Deferred().always(function(){i.stateContext&&c.removeClass(m.loading),e.proxy(i.complete,u)()}).done(function(t){o.debug("API request successful"),"json"==i.dataType?t.error!==n?e.proxy(i.failure,c)(t.error,i,u):e.isArray(t.errors)?e.proxy(i.failure,c)(t.errors[0],i,u):e.proxy(i.success,c)(t,i,u):e.proxy(i.success,c)(t,i,u)}).fail(function(t,r,a){var s,u=i.error[r]!==n?i.error[r]:a;if(t!==n)if(t.readyState!==n&&4==t.readyState){if(200!=t.status&&a!==n&&""!==a)o.error(l.statusMessage+a);else if("error"==r&&"json"==i.dataType)try{s=e.parseJSON(t.responseText),s&&s.error!==n&&(u=s.error)}catch(l){o.error(l.JSONParse)}c.removeClass(m.loading).addClass(m.error),i.errorLength>0&&setTimeout(function(){c.removeClass(m.error)},i.errorLength),o.debug("API Request error:",u),e.proxy(i.failure,c)(u,i,this)}else o.debug("Request Aborted (Most likely caused by page change)")}),e.extend(!0,v,i,{success:function(){},failure:function(){},complete:function(){},type:i.method||i.type,data:d,url:l,beforeSend:i.beforeXHR}),i.stateContext&&c.addClass(m.loading),i.progress&&(o.verbose("Adding progress events"),e.extend(!0,v,{xhr:function(){var r=new t.XMLHttpRequest;return r.upload.addEventListener("progress",function(t){var r;t.lengthComputable&&(r=Math.round(t.loaded/t.total*1e4)/100+"%",e.proxy(i.progress,c)(r,t))},!1),r.addEventListener("progress",function(t){var r;t.lengthComputable&&(r=Math.round(t.loaded/t.total*1e4)/100+"%",e.proxy(i.progress,c)(r,t))},!1),r}})),o.verbose("Creating AJAX request with settings: ",v),f=e.ajax(v).always(function(){a=i.loadingLength-((new Date).getTime()-p),i.loadingDelay=0>a?0:a}).done(function(e){var t=this;setTimeout(function(){s.resolveWith(t,[e])},i.loadingDelay)}).fail(function(e,t,r){var n=this;"abort"!=t?setTimeout(function(){s.rejectWith(n,[e,t,r])},i.loadingDelay):c.removeClass(m.error).removeClass(m.loading)}),i.stateContext&&u.data(h.promise,s).data(h.xhr,f),void 0):(o.error(b.missingURL),o.reset(),void 0):(o.error(b.beforeSend),o.reset(),void 0)},get:{formData:function(){return u.closest("form").toJSON()},templateURL:function(){var e,t=u.data(i.metadata.action)||i.action||!1;return t&&(o.debug("Creating url for: ",t),i.api[t]!==n?e=i.api[t]:o.error(b.missingAction)),i.url&&(e=i.url,o.debug("Getting url",e)),e},url:function(t,r){var a;return t&&(a=t.match(i.regExpTemplate),r=r||i.urlData,a&&(o.debug("Looking for URL variables",a),e.each(a,function(i,s){var c=s.substr(2,s.length-3),l=e.isPlainObject(r)&&r[c]!==n?r[c]:u.data(c)!==n?u.data(c):r[c];if(o.verbose("Looking for variable",c,u,u.data(c),r[c]),l===!1)o.debug("Removing variable from URL",a),t=t.replace("/"+s,"");else{if(l===n||!l)return o.error(b.missingParameter+c),t=!1,!1;t=t.replace(s,l)}}))),t}},reset:function(){u.data(h.promise,!1).data(h.xhr,!1),c.removeClass(m.error).removeClass(m.loading)},setting:function(t,r){if(e.isPlainObject(t))e.extend(!0,i,t);else{if(r===n)return i[t];i[t]=r}},internal:function(t,r){if(e.isPlainObject(t))e.extend(!0,o,t);else{if(r===n)return o[t];o[t]=r}},debug:function(){i.debug&&(i.performance?o.performance.log(arguments):(o.debug=Function.prototype.bind.call(console.info,console,i.name+":"),o.debug.apply(console,arguments)))},verbose:function(){i.verbose&&i.debug&&(i.performance?o.performance.log(arguments):(o.verbose=Function.prototype.bind.call(console.info,console,i.name+":"),o.verbose.apply(console,arguments)))},error:function(){o.error=Function.prototype.bind.call(console.error,console,i.name+":"),o.error.apply(console,arguments)},performance:{log:function(e){var t,r,n;i.performance&&(t=(new Date).getTime(),n=d||t,r=t-n,d=t,f.push({Element:l,Name:e[0],Arguments:[].slice.call(e,1)||"","Execution Time":r})),clearTimeout(o.performance.timer),o.performance.timer=setTimeout(o.performance.display,100)},display:function(){var t=i.name+":",r=0;d=!1,clearTimeout(o.performance.timer),e.each(f,function(e,t){r+=t["Execution Time"]}),t+=" "+r+"ms",p&&(t+=" '"+p+"'"),(console.group!==n||console.table!==n)&&f.length>0&&(console.groupCollapsed(t),console.table?console.table(f):e.each(f,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),f=[]}},invoke:function(t,r,o){var i,s,c,u=v;return r=r||C,o=l||o,"string"==typeof t&&u!==n&&(t=t.split(/[\. ]/),i=t.length-1,e.each(t,function(r,o){var a=r!=i?o+t[r+1].charAt(0).toUpperCase()+t[r+1].slice(1):t;if(e.isPlainObject(u[a])&&r!=i)u=u[a];else{if(u[a]!==n)return s=u[a],!1;if(!e.isPlainObject(u[o])||r==i)return u[o]!==n?(s=u[o],!1):!1;u=u[o]}})),e.isFunction(s)?c=s.apply(o,r):s!==n&&(c=s),e.isArray(a)?a.push(c):a!==n?a=[a,c]:c!==n&&(a=c),s}},y?(v===n&&o.initialize(),o.invoke(x)):(v!==n&&o.destroy(),o.initialize()),a!==n?a:this},e.fn.apiButton=function(t){return e(this).each(function(){var r,n=e(this),o=e(this).selector||"",a=e.isFunction(t)?e.extend(!0,{},e.api.settings,e.fn.apiButton.settings,{stateContext:this,success:t}):e.extend(!0,{},e.api.settings,e.fn.apiButton.settings,{stateContext:this},t);r={initialize:function(){a.context&&""!==o?e(a.context).on(o,"click."+a.namespace,r.click):n.on("click."+a.namespace,r.click)},click:function(){a.filter&&0!==e(this).filter(a.filter).size()||e.proxy(e.api,this)(a)}},r.initialize()}),this},e.api.settings={name:"API",namespace:"api",debug:!0,verbose:!0,performance:!0,api:{},beforeSend:function(e){return e},beforeXHR:function(){},success:function(){},complete:function(){},failure:function(){},progress:!1,error:{missingAction:"API action used but no url was defined",missingURL:"URL not specified for the API action",missingParameter:"Missing an essential URL parameter: ",timeout:"Your request timed out",error:"There was an error with your request",parseError:"There was an error parsing your request",JSONParse:"JSON could not be parsed during error handling",statusMessage:"Server gave an error: ",beforeSend:"The before send function has aborted the request",exitConditions:"API Request Aborted. Exit conditions met"},className:{loading:"loading",error:"error"},metadata:{action:"action",promise:"promise",xhr:"xhr"},regExpTemplate:/\{\$([A-z]+)\}/g,action:!1,url:!1,urlData:!1,serializeForm:!1,stateContext:!1,method:"get",data:{},dataType:"json",cache:!0,loadingLength:200,errorLength:2e3},e.fn.apiButton.settings={filter:".disabled, .loading",context:!1,stateContext:!1}}(jQuery,window,document);