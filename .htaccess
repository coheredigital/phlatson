
# Prevent file browsing
Options -Indexes
Options +FollowSymLinks

# Flatbed will handle 404s
ErrorDocument 404 /index.php

<Files favicon.ico>
  ErrorDocument 404 "The requested file favicon.ico was not found.
</Files>

<Files robots.txt>
  ErrorDocument 404 "The requested file robots.txt was not found.
</Files>


<IfModule mod_headers.c>
  # disallow iframe ebedding of site
  Header always append X-Frame-Options SAMEORIGIN
  # prevent mime-based attacks
  Header set X-Content-Type-Options "nosniff"
</IfModule>

# Default directory index
DirectoryIndex index.php index.html index.htm


# rewrite rules
<IfModule mod_rewrite.c>

	RewriteEngine On
	AddDefaultCharset UTF-8

    <IfModule mod_env.c>
      SetEnv HTTP_MOD_REWRITE On
    </IfModule>

	# RewriteBase /

    # Lets Encrypt support
    RewriteRule "(^|/)\.(?!well-known)" - [F]

    # Access Restrictions

    # Block access to any htaccess files
    RewriteCond %{REQUEST_URI} (^|/)\.htaccess$ [NC,OR]
    # Block access to data directories
    RewriteCond %{REQUEST_URI} (^|/)site/(fields|templates|config|users)($|/.*$) [OR]
    # Block access to page JSON data files
    RewriteCond %{REQUEST_URI} (^|/)site/.*\.(json)$ [OR]
    # Block direct access to any PHP files in site
    RewriteCond %{REQUEST_URI} (^|/)site/.*\.(php|inc|html|html|tpl|module)$ [OR]
    # Block access to any PHP files in system
    RewriteCond %{REQUEST_URI} (^|/)system/.*\.(php|inc|html|html|tpl|module)$ [OR]
    # Block access to any software identifying txt files
    RewriteCond %{REQUEST_URI} (^|/)(COPYRIGHT|README|htaccess)\.(txt|md)$
    # If any conditions above match, isssue a 403 forbidden
    RewriteRule ^.*$ - [F,L]

    # allow direct file access
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteCond %{REQUEST_FILENAME} !(favicon\.ico|robots\.txt)

    # prevent flatbed from attempting to load images or anything in assets
    RewriteCond %{REQUEST_FILENAME} !\.(jpg|jpeg|gif|png|ico)$ [NC]
    RewriteCond %{REQUEST_FILENAME} !(^|/)site/assets/

    # don't send missing image request through Flatbed
    RewriteCond %{REQUEST_URI} !\.(gif|jpg|png|ico)$ [NC]

    # pass request to Flatbed (use the seconf rule here instead if using VirtualDocumentRoot)
	RewriteRule ^(.*)$ index.php?_uri=$1 [L,QSA]


</IfModule>
